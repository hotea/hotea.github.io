---
import BaseLayout from '../layouts/BaseLayout.astro';
import { fetchRepos, getLangColor } from '../data/github';

const repos = await fetchRepos();
---

<BaseLayout title="Projects - Hotea" description="My open source projects on GitHub.">
  <section class="max-w-4xl mx-auto px-6 pt-20 pb-8">
    <h1 class="text-3xl font-bold tracking-tight mb-2">Projects</h1>
    <p class="text-text-muted">
      Open source projects from my
      <a href="https://github.com/hotea" target="_blank" rel="noopener noreferrer" class="text-accent hover:underline">GitHub</a>.
    </p>
  </section>

  <section class="max-w-4xl mx-auto px-6 pb-20">
    {repos.length > 0 ? (
      <div class="grid gap-4 sm:grid-cols-2">
        {repos.map((repo) => (
          <a
            href={repo.homepage || repo.url}
            target="_blank"
            rel="noopener noreferrer"
            class="group block p-6 rounded-xl border border-border hover:border-accent/50 hover:shadow-sm transition-all"
          >
            <div class="flex items-start justify-between mb-2">
              <h2 class="font-semibold group-hover:text-accent transition-colors truncate">
                {repo.name}
              </h2>
              <div class="flex items-center gap-2 shrink-0 ml-3">
                {repo.archived && (
                  <span class="text-[10px] px-1.5 py-0.5 rounded border border-amber-300 text-amber-600 leading-none">
                    archived
                  </span>
                )}
                {repo.stars > 0 && (
                  <span class="flex items-center gap-0.5 text-xs text-text-muted">
                    <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 16 16">
                      <path d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25z"/>
                    </svg>
                    {repo.stars}
                  </span>
                )}
              </div>
            </div>
            <p class="text-sm text-text-muted mb-4 leading-relaxed line-clamp-2">
              {repo.description || 'No description'}
            </p>
            <div class="flex items-center gap-3">
              {repo.language && (
                <span class="flex items-center gap-1.5 text-xs text-text-muted">
                  <span class="w-2.5 h-2.5 rounded-full" style={`background-color: ${getLangColor(repo.language)}`} />
                  {repo.language}
                </span>
              )}
              {repo.homepage && (
                <span class="text-xs text-accent">
                  demo
                </span>
              )}
            </div>
          </a>
        ))}
      </div>
    ) : (
      <p class="text-text-muted py-8">Failed to load projects. Please visit
        <a href="https://github.com/hotea" class="text-accent hover:underline">GitHub</a> directly.
      </p>
    )}
  </section>
</BaseLayout>
